<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Eco Tag - Sostenibilidad Empresarial</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }
        :root { --primary: #2ecc71; --primary-dark: #27ae60; --dark: #2c3e50; --danger: #e74c3c; --warning: #f39c12; --white: #ffffff; }
        body { background: #f9f9f9; color: #333; }
        .container { max-width: 1200px; margin: 0 auto; padding: 0 20px; }
        
        header { background: var(--white); box-shadow: 0 2px 10px rgba(0,0,0,0.1); position: fixed; width: 100%; top: 0; z-index: 1000; }
        .header-container { display: flex; justify-content: space-between; align-items: center; padding: 15px 0; }
        .logo { display: flex; align-items: center; }
        .logo i { font-size: 32px; color: var(--primary); margin-right: 10px; }
        .logo h1 { font-size: 24px; color: var(--primary); }
        
        .btn { padding: 10px 20px; border-radius: 50px; border: none; cursor: pointer; font-weight: 600; margin: 5px; transition: all 0.3s; }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
        .btn-primary { background: var(--primary); color: white; }
        .btn-outline { background: transparent; border: 2px solid var(--primary); color: var(--primary); }
        .btn-danger { background: var(--danger); color: white; }
        .btn-warning { background: var(--warning); color: white; }
        .btn-block { width: 100%; }
        
        .hero { padding: 150px 0 100px; background: linear-gradient(135deg, #2ecc71 0%, #3498db 100%); color: white; text-align: center; }
        
        .user-menu { display: none; }
        .auth-buttons { display: flex; }
        body[data-auth="true"] .auth-buttons { display: none; }
        body[data-auth="true"] .user-menu { display: block; }
        
        .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: none; justify-content: center; align-items: center; z-index: 2000; }
        .modal.active { display: flex; }
        .modal-content { background: white; padding: 30px; border-radius: 10px; width: 90%; max-width: 400px; position: relative; }
        .close-modal { position: absolute; top: 15px; right: 15px; background: none; border: none; font-size: 24px; cursor: pointer; color: #95a5a6; }
        .form-group { margin-bottom: 15px; }
        .form-group input { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px; }
        .form-group label { display: block; margin-bottom: 5px; font-weight: 500; }

        /* Scanner Styles */
        .scanner { padding: 80px 0; background: var(--white); display: none; }
        .scanner-container { display: flex; flex-direction: column; align-items: center; }
        .camera-view { width: 100%; max-width: 400px; height: 300px; background: #f1f1f1; border-radius: 10px; display: flex; justify-content: center; align-items: center; margin-bottom: 20px; }
        .scanning-frame { text-align: center; color: #95a5a6; }
        .scanning-frame i { font-size: 3rem; margin-bottom: 10px; display: block; }
        .camera-controls { display: flex; gap: 10px; justify-content: center; margin-bottom: 20px; flex-wrap: wrap; }
        #scanner-video { width: 100%; max-width: 400px; border-radius: 10px; display: none; }
        #scanner-video.active { display: block; }
        .camera-view.hidden { display: none; }
        .scan-result { background: var(--white); border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); padding: 30px; margin-top: 30px; display: none; width: 100%; max-width: 800px; }
        .scan-result.active { display: block; }
        .product-info { display: flex; align-items: center; margin-bottom: 20px; }
        .product-info i { font-size: 48px; padding: 16px; background: #f1f1f1; border-radius: 10px; margin-right: 20px; color: var(--primary); }
        .score-bar { height: 20px; background: #f1f1f1; border-radius: 10px; overflow: hidden; margin: 10px 0; }
        .score-fill { height: 100%; background: var(--primary); border-radius: 10px; width: 0; transition: width 1s ease-in-out; }
        .improvement-list { list-style: none; }
        .improvement-list li { padding: 10px 0; border-bottom: 1px solid #eee; display: flex; align-items: center; }
        .improvement-list li i { color: #f39c12; margin-right: 10px; }
        
        /* Dashboard */
        .dashboard { padding: 100px 0 50px; display: none; }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 40px; }
        .stat-card { background: white; padding: 25px; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.05); text-align: center; }
        .stat-card i { font-size: 40px; margin-bottom: 15px; color: var(--primary); }
        .stat-value { font-size: 32px; font-weight: bold; margin: 10px 0; }
        .scan-history { background: white; padding: 25px; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.05); }
        
        /* Notifications */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            border-radius: 5px;
            color: white;
            font-weight: 500;
            z-index: 3000;
            transform: translateX(150%);
            transition: transform 0.3s ease;
        }
        .notification.show { transform: translateX(0); }
        .notification.success { background: var(--primary); }
        .notification.error { background: var(--danger); }
        .notification.warning { background: var(--warning); }
        .notification.info { background: #3498db; }
        
        /* Loading */
        .loading { display: inline-block; width: 20px; height: 20px; border: 3px solid rgba(255,255,255,.3); border-radius: 50%; border-top-color: #fff; animation: spin 1s ease-in-out infinite; margin-right: 10px; }
        @keyframes spin { to { transform: rotate(360deg); } }
        
        /* Navigation */
        .nav-tabs { display: flex; border-bottom: 1px solid #eee; margin-bottom: 20px; }
        .nav-tab { padding: 10px 20px; cursor: pointer; border-bottom: 3px solid transparent; }
        .nav-tab.active { border-bottom-color: var(--primary); color: var(--primary); font-weight: 600; }
        
        /* Responsive */
        @media (max-width: 768px) {
            .header-container { flex-direction: column; padding: 10px 0; }
            .logo { margin-bottom: 10px; }
            .hero { padding: 120px 0 60px; }
            .stats-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <header>
        <div class="container header-container">
            <div class="logo">
                <i class="fas fa-leaf"></i>
                <h1>Eco Tag</h1>
            </div>
            
            <div class="auth-buttons">
                <button class="btn btn-outline" id="loginBtn">Iniciar Sesi√≥n</button>
                <button class="btn btn-primary" id="registerBtn">Registrarse</button>
            </div>

            <div class="user-menu">
                <span id="userEmail" style="margin-right: 15px;"></span>
                <button class="btn btn-outline" id="dashboardBtn">Dashboard</button>
                <button class="btn btn-danger" id="logoutBtn">Cerrar Sesi√≥n</button>
            </div>
        </div>
    </header>
    
    <section class="hero" id="hero">
        <div class="container">
            <h2>Impulsa la Sostenibilidad</h2>
            <p>Plataforma de an√°lisis de sostenibilidad para productos.</p>
            <div class="hero-buttons">
                <button class="btn btn-primary" id="startBtn">Comenzar Ahora</button>
                <button class="btn btn-outline" style="background: rgba(255,255,255,0.2); color: white; border-color: white;" id="demoBtn">Ver Demo</button>
            </div>
        </div>
    </section>

    <!-- Dashboard Section -->
    <section class="dashboard" id="dashboard">
        <div class="container">
            <h2>Dashboard Empresarial</h2>
            <div class="nav-tabs">
                <div class="nav-tab active" data-tab="overview">Resumen</div>
                <div class="nav-tab" data-tab="scanner">Esc√°ner</div>
                <div class="nav-tab" data-tab="history">Historial</div>
            </div>
            
            <div id="overviewTab" class="tab-content">
                <div class="stats-grid">
                    <div class="stat-card">
                        <i class="fas fa-chart-line"></i>
                        <h3>Puntuaci√≥n Promedio</h3>
                        <div class="stat-value" id="avgScore">72%</div>
                        <p>Sostenibilidad general</p>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-cube"></i>
                        <h3>Productos Escaneados</h3>
                        <div class="stat-value" id="totalScans">24</div>
                        <p>Este mes</p>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-trophy"></i>
                        <h3>Mejor Puntuaci√≥n</h3>
                        <div class="stat-value" id="bestScore">89%</div>
                        <p>Producto l√≠der</p>
                    </div>
                </div>
                
                <div class="scan-history">
                    <h3>Escaneos Recientes</h3>
                    <div id="recentScans">
                        <p>Cargando escaneos recientes...</p>
                    </div>
                </div>
            </div>
            
            <div id="scannerTab" class="tab-content" style="display: none;">
                <!-- Scanner content will be moved here when tab is active -->
            </div>
            
            <div id="historyTab" class="tab-content" style="display: none;">
                <div class="scan-history">
                    <h3>Historial Completo</h3>
                    <div id="fullHistory">
                        <p>Cargando historial completo...</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Scanner Section -->
    <section class="scanner" id="scanner">
        <div class="container">
            <div class="scanner-container">
                <h2>Esc√°ner de Productos</h2>
                <div class="scanner-wrapper">
                    <video id="scanner-video" autoplay playsinline></video>
                    <div id="camera-view" class="camera-view">
                        <div class="scanning-frame">
                            <i class="fas fa-camera"></i>
                            <p>Enfoca el c√≥digo de barras del producto</p>
                        </div>
                    </div>
                    
                    <div class="camera-controls">
                        <button id="start-camera" class="btn btn-primary">
                            <i class="fas fa-camera"></i> Activar C√°mara
                        </button>
                        <button id="switch-camera" class="btn btn-outline" disabled>
                            <i class="fas fa-sync"></i> Cambiar C√°mara
                        </button>
                        <button id="capture-btn" class="btn btn-warning" disabled>
                            <i class="fas fa-camera"></i> Capturar Imagen
                        </button>
                    </div>
                </div>
                
                <div class="scan-result" id="scanResult">
                    <div class="product-info">
                        <i class="fas fa-cube"></i>
                        <div>
                            <h4 id="productName">Producto Escaneado</h4>
                            <p id="productBrand">Marca del producto</p>
                        </div>
                    </div>
                    
                    <div class="sustainability-score">
                        <h3>Puntuaci√≥n de Sostenibilidad</h3>
                        <div class="score-bar">
                            <div class="score-fill" id="scoreFill"></div>
                        </div>
                        <p><span class="score-value" id="scoreValue">0%</span> Sostenible</p>
                    </div>
                    
                    <div class="improvements">
                        <h3>Recomendaciones de Mejora</h3>
                        <ul class="improvement-list" id="improvementList"></ul>
                    </div>
                    
                    <div class="action-buttons" style="margin-top: 20px; text-align: center;">
                        <button class="btn btn-primary" id="newScanBtn">Nuevo Escaneo</button>
                        <button class="btn btn-outline" id="saveReportBtn">Guardar Reporte</button>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Modal Login -->
    <div class="modal" id="loginModal">
        <div class="modal-content">
            <button class="close-modal">&times;</button>
            <h2>Iniciar Sesi√≥n</h2>
            <form id="loginForm">
                <div class="form-group">
                    <label for="loginEmail">Email</label>
                    <input type="email" id="loginEmail" placeholder="tu@empresa.com" required>
                </div>
                <div class="form-group">
                    <label for="loginPassword">Contrase√±a</label>
                    <input type="password" id="loginPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
                </div>
                <button type="submit" class="btn btn-primary btn-block">
                    <span id="loginText">Iniciar Sesi√≥n</span>
                    <span id="loginSpinner" class="loading" style="display: none;"></span>
                </button>
            </form>
            <p style="text-align: center; margin-top: 15px;">
                ¬øNo tienes cuenta? <a href="#" id="goToRegister" style="color: var(--primary);">Reg√≠strate aqu√≠</a>
            </p>
        </div>
    </div>

    <!-- Modal Registro -->
    <div class="modal" id="registerModal">
        <div class="modal-content">
            <button class="close-modal">&times;</button>
            <h2>Registrarse</h2>
            <form id="registerForm">
                <div class="form-group">
                    <label for="registerCompany">Nombre de Empresa</label>
                    <input type="text" id="registerCompany" placeholder="Mi Empresa S.A." required>
                </div>
                <div class="form-group">
                    <label for="registerEmail">Email</label>
                    <input type="email" id="registerEmail" placeholder="tu@empresa.com" required>
                </div>
                <div class="form-group">
                    <label for="registerPassword">Contrase√±a</label>
                    <input type="password" id="registerPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required minlength="6">
                </div>
                <div class="form-group">
                    <label for="registerConfirmPassword">Confirmar Contrase√±a</label>
                    <input type="password" id="registerConfirmPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
                </div>
                <button type="submit" class="btn btn-primary btn-block">
                    <span id="registerText">Registrarse</span>
                    <span id="registerSpinner" class="loading" style="display: none;"></span>
                </button>
            </form>
            <p style="text-align: center; margin-top: 15px;">
                ¬øYa tienes cuenta? <a href="#" id="goToLogin" style="color: var(--primary);">Inicia sesi√≥n aqu√≠</a>
            </p>
        </div>
    </div>

    <script>
        // ===============================
        // üéØ VARIABLES GLOBALES
        // ===============================
        let stream = null;
        let currentFacingMode = 'environment';
        let scannerInterval = null;
        let scanCompleted = false;
        let currentUser = null;

        // ===============================
        // üõ†Ô∏è FUNCIONES DE UTILIDAD
        // ===============================
        function showNotification(message, type = 'success') {
            // Eliminar notificaci√≥n existente
            const existingNotification = document.getElementById('notification');
            if (existingNotification) {
                existingNotification.remove();
            }
            
            // Crear nueva notificaci√≥n
            const notification = document.createElement('div');
            notification.id = 'notification';
            notification.className = `notification ${type}`;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            // Mostrar notificaci√≥n
            setTimeout(() => notification.classList.add('show'), 100);
            
            // Ocultar despu√©s de 4 segundos
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => notification.remove(), 300);
            }, 4000);
        }

        function openModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.add('active');
                document.body.style.overflow = 'hidden';
            }
        }

        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.remove('active');
                document.body.style.overflow = 'auto';
            }
        }

        function showSection(sectionId) {
            // Ocultar todas las secciones
            document.querySelectorAll('section').forEach(section => {
                section.style.display = 'none';
            });
            
            // Mostrar la secci√≥n solicitada
            const section = document.getElementById(sectionId);
            if (section) {
                section.style.display = 'block';
            }
        }

        function updateAuthUI(isAuthenticated, userData = null) {
            document.body.setAttribute('data-auth', isAuthenticated);
            
            if (isAuthenticated && userData) {
                document.getElementById('userEmail').textContent = userData.email;
                showSection('dashboard');
                loadDashboardData();
            } else {
                showSection('hero');
            }
        }

        // ===============================
        // üîê SISTEMA DE AUTENTICACI√ìN (SIMULADO)
        // ===============================
        function handleRegister(e) {
            e.preventDefault();
            
            const company = document.getElementById('registerCompany').value;
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;
            const confirmPassword = document.getElementById('registerConfirmPassword').value;

            // Validaciones
            if (!company || !email || !password || !confirmPassword) {
                showNotification('Por favor completa todos los campos', 'error');
                return;
            }

            if (password !== confirmPassword) {
                showNotification('Las contrase√±as no coinciden', 'error');
                return;
            }

            if (password.length < 6) {
                showNotification('La contrase√±a debe tener al menos 6 caracteres', 'error');
                return;
            }

            // Simular registro
            const registerText = document.getElementById('registerText');
            const registerSpinner = document.getElementById('registerSpinner');
            
            registerText.style.display = 'none';
            registerSpinner.style.display = 'inline-block';

            setTimeout(() => {
                // Simular √©xito de registro
                currentUser = {
                    email: email,
                    company: company,
                    id: 'user_' + Date.now()
                };
                
                showNotification(`¬°Bienvenido a Eco Tag, ${company}!`, 'success');
                closeModal('registerModal');
                updateAuthUI(true, currentUser);
                
                // Restaurar UI del bot√≥n
                registerText.style.display = 'inline-block';
                registerSpinner.style.display = 'none';
                document.getElementById('registerForm').reset();
            }, 1500);
        }

        function handleLogin(e) {
            e.preventDefault();
            
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;

            if (!email || !password) {
                showNotification('Por favor completa todos los campos', 'error');
                return;
            }

            const loginText = document.getElementById('loginText');
            const loginSpinner = document.getElementById('loginSpinner');
            
            loginText.style.display = 'none';
            loginSpinner.style.display = 'inline-block';

            setTimeout(() => {
                // Simular √©xito de login
                currentUser = {
                    email: email,
                    company: email.split('@')[0],
                    id: 'user_' + Date.now()
                };
                
                showNotification(`¬°Bienvenido de vuelta, ${currentUser.company}!`, 'success');
                closeModal('loginModal');
                updateAuthUI(true, currentUser);
                
                // Restaurar UI del bot√≥n
                loginText.style.display = 'inline-block';
                loginSpinner.style.display = 'none';
                document.getElementById('loginForm').reset();
            }, 1500);
        }

        function handleLogout() {
            currentUser = null;
            updateAuthUI(false);
            showNotification('Sesi√≥n cerrada correctamente', 'info');
        }

        // ===============================
        // üìä DASHBOARD Y DATOS
        // ===============================
        function loadDashboardData() {
            // Simular carga de datos del dashboard
            setTimeout(() => {
                document.getElementById('avgScore').textContent = '72%';
                document.getElementById('totalScans').textContent = '24';
                document.getElementById('bestScore').textContent = '89%';
                
                // Simular escaneos recientes
                const recentScans = [
                    { product: 'Botella Agua Mineral', score: 65, date: '2023-11-15' },
                    { product: 'Galletas Integrales', score: 78, date: '2023-11-14' },
                    { product: 'Detergente Ecol√≥gico', score: 89, date: '2023-11-13' }
                ];
                
                const recentScansHTML = recentScans.map(scan => `
                    <div style="padding: 10px; border-bottom: 1px solid #eee; display: flex; justify-content: between;">
                        <div style="flex: 1;">
                            <strong>${scan.product}</strong>
                            <div style="font-size: 0.9em; color: #666;">${scan.date}</div>
                        </div>
                        <div style="font-weight: bold; color: ${scan.score >= 70 ? '#2ecc71' : scan.score >= 50 ? '#f39c12' : '#e74c3c'}">
                            ${scan.score}%
                        </div>
                    </div>
                `).join('');
                
                document.getElementById('recentScans').innerHTML = recentScansHTML;
            }, 1000);
        }

        // ===============================
        // üì∑ SISTEMA DE C√ÅMARA Y ESCANEO
        // ===============================
        async function startCamera() {
            try {
                const video = document.getElementById('scanner-video');
                const cameraView = document.getElementById('camera-view');
                const startBtn = document.getElementById('start-camera');
                const captureBtn = document.getElementById('capture-btn');
                const switchBtn = document.getElementById('switch-camera');

                // Verificar permisos de c√°mara
                if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
                    stream = await navigator.mediaDevices.getUserMedia({
                        video: { 
                            facingMode: currentFacingMode,
                            width: { ideal: 1280 },
                            height: { ideal: 720 }
                        }
                    });

                    video.srcObject = stream;
                    video.classList.add('active');
                    
                    cameraView.classList.add('hidden');
                    captureBtn.disabled = false;
                    switchBtn.disabled = false;
                    startBtn.disabled = true;
                    startBtn.innerHTML = '<i class="fas fa-sync"></i> Reiniciar C√°mara';
                    
                    showNotification('C√°mara activada correctamente', 'success');
                    
                } else {
                    showNotification('Tu navegador no soporta acceso a la c√°mara', 'error');
                }
                
            } catch (error) {
                console.error('Error accediendo a la c√°mara:', error);
                showNotification('Error al acceder a la c√°mara: ' + error.message, 'error');
            }
        }

        function stopCamera() {
            if (stream) {
                stream.getTracks().forEach(track => track.stop());
                stream = null;
            }
            
            const video = document.getElementById('scanner-video');
            const cameraView = document.getElementById('camera-view');
            const startBtn = document.getElementById('start-camera');
            const captureBtn = document.getElementById('capture-btn');
            const switchBtn = document.getElementById('switch-camera');

            if (video) {
                video.srcObject = null;
                video.classList.remove('active');
            }
            
            cameraView.classList.remove('hidden');
            captureBtn.disabled = true;
            switchBtn.disabled = true;
            startBtn.disabled = false;
            startBtn.innerHTML = '<i class="fas fa-camera"></i> Activar C√°mara';
        }

        function switchCamera() {
            stopCamera();
            currentFacingMode = currentFacingMode === 'environment' ? 'user' : 'environment';
            setTimeout(startCamera, 500);
        }

        function captureImage() {
            showNotification('Procesando imagen...', 'warning');
            
            // Simular procesamiento de imagen
            setTimeout(() => {
                const mockProduct = {
                    name: "Botella de Agua Mineral",
                    brand: "AguaPure",
                    category: "Bebidas",
                    sustainabilityScore: 65,
                    barcode: "1234567890123",
                    recommendations: [
                        "Envase: Reducir pl√°stico de un solo uso (Alto impacto)",
                        "Cadena de suministro: Utilizar proveedores locales (Medio impacto)",
                        "Transporte: Optimizar rutas de distribuci√≥n (Bajo impacto)"
                    ]
                };
                
                showScanResults(mockProduct);
            }, 2000);
        }

        function showScanResults(product) {
            const scanResult = document.getElementById('scanResult');
            const scoreFill = document.getElementById('scoreFill');
            const productName = document.getElementById('productName');
            const productBrand = document.getElementById('productBrand');
            const scoreValue = document.getElementById('scoreValue');
            const improvementList = document.getElementById('improvementList');

            // Actualizar informaci√≥n del producto
            productName.textContent = product.name;
            productBrand.textContent = product.brand;
            scoreValue.textContent = `${product.sustainabilityScore}%`;
            
            // Animar la barra de puntuaci√≥n
            setTimeout(() => {
                scoreFill.style.width = `${product.sustainabilityScore}%`;
            }, 500);

            // Actualizar recomendaciones
            improvementList.innerHTML = '';
            product.recommendations.forEach(rec => {
                const li = document.createElement('li');
                li.innerHTML = `<i class="fas fa-lightbulb"></i> ${rec}`;
                improvementList.appendChild(li);
            });

            // Mostrar resultados
            scanResult.classList.add('active');
            showNotification('Escaneo completado exitosamente', 'success');
            
            // Desplazar hacia los resultados
            scanResult.scrollIntoView({ behavior: 'smooth' });
        }

        // ===============================
        // üéØ CONFIGURACI√ìN INICIAL
        // ===============================
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ Eco Tag inicializado');
            
            // Event Listeners para autenticaci√≥n
            document.getElementById('loginBtn').addEventListener('click', () => openModal('loginModal'));
            document.getElementById('registerBtn').addEventListener('click', () => openModal('registerModal'));
            document.getElementById('logoutBtn').addEventListener('click', handleLogout);
            document.getElementById('loginForm').addEventListener('submit', handleLogin);
            document.getElementById('registerForm').addEventListener('submit', handleRegister);
            document.getElementById('dashboardBtn').addEventListener('click', () => showSection('dashboard'));

            // Navegaci√≥n entre modales
            document.getElementById('goToRegister').addEventListener('click', (e) => {
                e.preventDefault();
                closeModal('loginModal');
                openModal('registerModal');
            });

            document.getElementById('goToLogin').addEventListener('click', (e) => {
                e.preventDefault();
                closeModal('registerModal');
                openModal('loginModal');
            });

            // Cerrar modales
            document.querySelectorAll('.close-modal').forEach(btn => {
                btn.addEventListener('click', function() {
                    const modal = this.closest('.modal');
                    if (modal) {
                        modal.classList.remove('active');
                        document.body.style.overflow = 'auto';
                    }
                });
            });

            document.querySelectorAll('.modal').forEach(modal => {
                modal.addEventListener('click', function(e) {
                    if (e.target === this) {
                        this.classList.remove('active');
                        document.body.style.overflow = 'auto';
                    }
                });
            });

            // Navegaci√≥n principal
            document.getElementById('startBtn').addEventListener('click', function() {
                if (currentUser) {
                    showSection('dashboard');
                } else {
                    openModal('registerModal');
                }
            });

            document.getElementById('demoBtn').addEventListener('click', function() {
                showSection('scanner');
                showNotification('Modo demo activado - Funcionalidades limitadas', 'info');
            });

            // Sistema de pesta√±as del dashboard
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    // Remover clase active de todas las pesta√±as
                    document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
                    // Ocultar todos los contenidos
                    document.querySelectorAll('.tab-content').forEach(c => c.style.display = 'none');
                    
                    // Activar pesta√±a clickeada
                    this.classList.add('active');
                    const tabId = this.getAttribute('data-tab') + 'Tab';
                    document.getElementById(tabId).style.display = 'block';
                    
                    // Si es la pesta√±a del esc√°ner, mostrar esa secci√≥n
                    if (this.getAttribute('data-tab') === 'scanner') {
                        showSection('scanner');
                    }
                });
            });

            // Controles de c√°mara
            document.getElementById('start-camera').addEventListener('click', startCamera);
            document.getElementById('capture-btn').addEventListener('click', captureImage);
            document.getElementById('switch-camera').addEventListener('click', switchCamera);
            document.getElementById('newScanBtn').addEventListener('click', function() {
                document.getElementById('scanResult').classList.remove('active');
                stopCamera();
                setTimeout(startCamera, 500);
            });

            // Inicializar UI
            updateAuthUI(false);
        });

        // Limpiar al cerrar
        window.addEventListener('beforeunload', stopCamera);
    </script>
</body>
</html>